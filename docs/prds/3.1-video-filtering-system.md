# PRD 3.1: Video Filtering System

## Overview
Implement a flexible video filtering system that can identify videos based on various criteria for processing.

## Requirements

### Core Deliverables
- [ ] `scripts/filter-videos.ts` - Main script
- [ ] Filter by title_contains, description_contains
- [ ] Filter by title_not_contains, description_not_contains
- [ ] Support for metadata version checking
- [ ] Configurable filter rules
- [ ] Preview mode (show count without processing)

### Dependencies
- PRD 2.1 (Video Database Builder)
- PRD 1.3 (Configuration System)

### Technical Specifications

#### Script Interface
```bash
# Filter by title contains
ts-node scripts/filter-videos.ts --title-contains "Tom Clancy"

# Filter by description not contains
ts-node scripts/filter-videos.ts --description-not-contains "[metadata"

# Multiple filters
ts-node scripts/filter-videos.ts --title-contains "Tom Clancy" --description-not-contains "[metadata"

# Preview mode (count only)
ts-node scripts/filter-videos.ts --preview --title-contains "Tom Clancy"

# Use configuration file
ts-node scripts/filter-videos.ts --config config/initial-processing.json

# Verbose output
ts-node scripts/filter-videos.ts --verbose --title-contains "Tom Clancy"
```

#### Filter Types
```typescript
interface FilterRule {
  type: 'title_contains' | 'title_not_contains' | 'description_contains' | 'description_not_contains' | 'metadata_version';
  value: string;
  caseSensitive?: boolean;
}

interface FilterResult {
  videoId: string;
  title: string;
  description: string;
  matchedRules: string[];
  recordingDate?: string;
}
```

#### Configuration Format
```json
{
  "initialProcessing": {
    "enabled": true,
    "filters": [
      {
        "type": "title_contains",
        "value": "Tom Clancy",
        "caseSensitive": false
      },
      {
        "type": "description_not_contains",
        "value": "[metadata",
        "caseSensitive": false
      }
    ]
  }
}
```

#### Filtering Logic
- **Case Sensitivity**: Default to case-insensitive
- **Multiple Filters**: AND logic (all filters must match)
- **Metadata Version**: Check for `[metadata vX.X` pattern
- **Partial Matches**: Support substring matching
- **Performance**: Use efficient string operations

#### Output Formats

##### Preview Mode
```
Found 45 videos matching criteria:
- title_contains: "Tom Clancy"
- description_not_contains: "[metadata"

Videos to be processed:
1. video_id_1: "Tom Clancy's The Division 2 2025 03 29..."
2. video_id_2: "Tom Clancy's The Division 2 2025 03 30..."
...
```

##### Full Mode
```json
{
  "filterCriteria": [
    {"type": "title_contains", "value": "Tom Clancy"},
    {"type": "description_not_contains", "value": "[metadata"}
  ],
  "totalVideos": 45,
  "videos": [
    {
      "videoId": "video_id_1",
      "title": "Tom Clancy's The Division 2 2025 03 29...",
      "description": "Tom Clancy's The Division 2 2025 03 29...",
      "matchedRules": ["title_contains", "description_not_contains"],
      "recordingDate": "2025-03-29T10:01:17Z"
    }
  ]
}
```

#### Performance Considerations
- **Large Databases**: Efficient filtering algorithms
- **Memory Usage**: Stream processing for large datasets
- **Caching**: Cache filter results for repeated queries
- **Indexing**: Use video database structure for fast lookups

## Acceptance Criteria
- [ ] Correctly filters videos based on all filter types
- [ ] Handles case sensitivity properly
- [ ] Supports multiple filter combinations
- [ ] Preview mode shows accurate counts
- [ ] Configuration file loading works correctly
- [ ] Performance is acceptable for large video databases
- [ ] Clear, readable output in both modes

## Edge Cases
- Handle videos with missing titles or descriptions
- Deal with very long titles/descriptions
- Handle special characters in filter values
- Manage empty filter results
- Handle malformed metadata version tags

## Dependencies
- PRD 2.1 (Video Database Builder)
- PRD 1.3 (Configuration System)

## Estimated Time
2 hours

## Notes
This system provides the foundation for identifying which videos need processing. The filtering logic should be flexible and efficient.
