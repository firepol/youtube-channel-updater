# PRD 4.1: Main Update Script

## Overview
Create a unified video update script that orchestrates all processing steps with comprehensive command-line options.

## Requirements

### Core Deliverables
- [ ] `scripts/update-videos.ts` - Main orchestration script
- [ ] Orchestrate all processing steps
- [ ] Command-line arguments for different modes
- [ ] Progress reporting
- [ ] Error recovery
- [ ] Dry-run mode

### Dependencies
- PRD 3.2 (Video Processing Engine)
- PRD 3.3 (Playlist Management)
- PRD 3.1 (Video Filtering System)

### Technical Specifications

#### Script Interface
```bash
# Full update process
ts-node scripts/update-videos.ts

# Filter and process specific videos
ts-node scripts/update-videos.ts --title-contains "Tom Clancy" --description-not-contains "[metadata"

# Process specific video
ts-node scripts/update-videos.ts --video-id video_id_1

# Dry run (no actual changes)
ts-node scripts/update-videos.ts --dry-run --title-contains "Tom Clancy"

# Skip playlist management
ts-node scripts/update-videos.ts --skip-playlists --title-contains "Tom Clancy"

# Force processing (ignore metadata version)
ts-node scripts/update-videos.ts --force --title-contains "Tom Clancy"

# Verbose logging
ts-node scripts/update-videos.ts --verbose --title-contains "Tom Clancy"

# Help
ts-node scripts/update-videos.ts --help
```

#### Command-Line Options
```typescript
interface UpdateOptions {
  // Filter options
  titleContains?: string;
  titleNotContains?: string;
  descriptionContains?: string;
  descriptionNotContains?: string;
  
  // Processing options
  videoId?: string;
  dryRun: boolean;
  force: boolean;
  skipPlaylists: boolean;
  
  // Output options
  verbose: boolean;
  quiet: boolean;
  
  // Configuration
  configFile?: string;
}
```

#### Processing Pipeline
1. **Load Configuration**: Environment and config files
2. **Filter Videos**: Apply filter criteria
3. **Validate Input**: Check for valid videos to process
4. **Backup Preparation**: Ensure backup system is ready
5. **Process Videos**: Update metadata
6. **Manage Playlists**: Add to appropriate playlists
7. **Update Database**: Refresh local data
8. **Generate Report**: Summary of changes

#### Progress Reporting
```
YouTube Channel Updater v1.0
============================

Step 1/6: Loading configuration... ‚úÖ
Step 2/6: Filtering videos... ‚úÖ (45 videos found)
Step 3/6: Validating input... ‚úÖ (43 videos valid)
Step 4/6: Processing videos... üîÑ (15/43 completed)
Step 5/6: Managing playlists... ‚è∏Ô∏è (pending)
Step 6/6: Updating database... ‚è∏Ô∏è (pending)

Progress: 35% complete
Estimated time remaining: 00:08:30
```

#### Error Recovery
- **Resume Capability**: Can resume from any step
- **State Persistence**: Save progress between steps
- **Rollback Support**: Revert changes if needed
- **Partial Success**: Continue with successful items

#### Dry Run Mode
- **Simulation**: Show what would be done without making changes
- **Validation**: Check all configurations and data
- **Preview**: Display final video states
- **Cost Estimation**: Show API quota usage

#### Output Reports

##### Success Report
```json
{
  "summary": {
    "totalVideos": 45,
    "processedVideos": 43,
    "failedVideos": 2,
    "playlistAssignments": 67,
    "processingTime": "00:12:30",
    "apiQuotaUsed": 2150
  },
  "errors": [
    {
      "videoId": "video_id_1",
      "error": "Rate limit exceeded",
      "step": "processing"
    }
  ],
  "changes": [
    {
      "videoId": "video_id_2",
      "title": "Updated title",
      "description": "Updated description",
      "playlists": ["Dark Zone"]
    }
  ]
}
```

##### Dry Run Report
```json
{
  "mode": "dry-run",
  "videosToProcess": 45,
  "estimatedApiQuota": 2250,
  "playlistAssignments": 67,
  "preview": [
    {
      "videoId": "video_id_1",
      "currentTitle": "Original title",
      "newTitle": "DZ going rogue gone wrong / The Division 2 / 2025-03-29",
      "playlists": ["Dark Zone"]
    }
  ]
}
```

## Acceptance Criteria
- [ ] Orchestrates all processing steps correctly
- [ ] Provides comprehensive command-line options
- [ ] Shows clear progress reporting
- [ ] Handles errors gracefully with recovery options
- [ ] Dry run mode works accurately
- [ ] Generates detailed reports
- [ ] Respects rate limits throughout
- [ ] Provides helpful help text

## Edge Cases
- Handle interrupted processing
- Deal with configuration errors
- Manage API quota exhaustion
- Handle network failures
- Deal with partial processing failures
- Manage very large video sets

## Dependencies
- PRD 3.2 (Video Processing Engine)
- PRD 3.3 (Playlist Management)
- PRD 3.1 (Video Filtering System)

## Estimated Time
2 hours

## Notes
This is the main entry point for users. Focus on user experience and clear feedback.
