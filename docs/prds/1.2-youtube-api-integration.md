# PRD 1.2: YouTube API Integration

## Overview
Create a robust YouTube API client with proper authentication and rate limit handling.

## Requirements

### Core Deliverables
- [ ] `src/api/youtube-client.ts` - Main API wrapper
- [ ] `src/types/api-types.ts` - TypeScript interfaces
- [ ] Authentication handling (OAuth 2.0 + API Key)
- [ ] Rate limit tracking and management

### Dependencies
- PRD 1.1 (Project Initialization)
- YouTube Data API v3 credentials

### Technical Specifications

#### youtube-client.ts Requirements
- **Class Structure**: `YouTubeClient` class
- **Authentication Methods**:
  - `authenticate()` - OAuth 2.0 flow
  - `refreshToken()` - Token refresh logic
  - `validateCredentials()` - Credential validation
- **API Methods**:
  - `getVideos()` - Fetch channel videos
  - `getPlaylists()` - Fetch channel playlists
  - `getPlaylistItems()` - Fetch playlist videos
  - `updateVideo()` - Update video metadata
  - `addToPlaylist()` - Add video to playlist
- **Rate Limit Management**:
  - Track quota usage
  - Implement delays when approaching limits
  - Throw specific errors for rate limits

#### api-types.ts Requirements
```typescript
interface YouTubeVideo {
  id: string;
  title: string;
  description: string;
  publishedAt: string;
  thumbnails: object;
  tags?: string[];
  categoryId: string;
  defaultLanguage?: string;
  recordingDate?: string;
}

interface YouTubePlaylist {
  id: string;
  title: string;
  description: string;
  privacyStatus: string;
  itemCount: number;
}

interface PlaylistItem {
  id: string;
  videoId: string;
  position: number;
  publishedAt: string;
}

interface RateLimitInfo {
  quotaUsed: number;
  quotaLimit: number;
  resetTime: string;
}
```

#### Authentication Flow
1. **API Key**: For read operations (videos, playlists)
2. **OAuth 2.0**: For write operations (update videos, playlists)
3. **Token Refresh**: Automatic refresh before expiration
4. **Error Handling**: Clear error messages for auth failures

#### Rate Limit Strategy
- **Daily Quota**: 10,000 units
- **Tracking**: Monitor usage per operation
- **Throttling**: Implement delays when >80% quota used
- **Error Handling**: Stop immediately on quota exhaustion

## Acceptance Criteria
- [ ] Can authenticate with both API key and OAuth 2.0
- [ ] All API methods work correctly
- [ ] Rate limits are properly tracked and respected
- [ ] Error handling provides clear, actionable messages
- [ ] TypeScript types are complete and accurate
- [ ] Token refresh works automatically

## Edge Cases
- Handle network timeouts
- Manage token expiration gracefully
- Handle API version changes
- Deal with malformed API responses
- Handle quota exhaustion scenarios

## Dependencies
- PRD 1.1 (Project Initialization)
- `googleapis` package
- Valid YouTube API credentials

## Estimated Time
2 hours

## Notes
This is the core API integration that all other tasks depend on. Focus on reliability and proper error handling.
