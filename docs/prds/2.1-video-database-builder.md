# PRD 2.1: Video Database Builder

## Overview
Create a script to build the initial `videos.json` database containing all videos from the YouTube channel.

## Requirements

### Core Deliverables
- [ ] `scripts/build-video-database.ts` - Main script
- [ ] Paginated fetching of all channel videos
- [ ] Console logging of current page (for crash recovery)
- [ ] Duplicate prevention (check by video ID)
- [ ] Progress tracking and resume capability
- [ ] Extract datetime from title/description
- [ ] Handle rate limits gracefully
- [ ] `data/videos.json` output file

### Dependencies
- PRD 1.2 (YouTube API Integration)
- PRD 1.3 (Configuration System)

### Technical Specifications

#### Script Interface
```bash
# Basic usage
ts-node scripts/build-video-database.ts

# Resume from specific page
ts-node scripts/build-video-database.ts --resume-page 5

# Dry run (no file writing)
ts-node scripts/build-video-database.ts --dry-run

# Verbose logging
ts-node scripts/build-video-database.ts --verbose
```

#### Pagination Strategy
- **Page Size**: 50 videos per request (YouTube API max)
- **Progress Logging**: `Processing page X of Y (Z videos found)`
- **Resume Capability**: Store current page in temporary file
- **Rate Limit**: 1 unit per request (very efficient)

#### Data Extraction
- **Video ID**: Primary key
- **Title**: Full video title
- **Description**: Full description
- **Published Date**: YouTube published date
- **Recording Date**: Extracted from title/description
- **Last Updated**: Current timestamp

#### Datetime Extraction Logic
```typescript
interface DatetimeExtraction {
  // From title: Tom Clancys The Division 2 2025.03.29 - 10.01.17.02"
  // Extract: 2025-03-29T10:01:17Z
  extractFromTitle(title: string): string | null;
  
  // From description: "Tom Clancys The Division 2 2025 03 29 10 01 17 02
  // Extract: 2025-03-29T10:01:17Z
  extractFromDescription(description: string): string | null;
}
```

#### Output Format
```json
{
  "lastUpdated": "2025-06-27T15:50:45Z",
  "totalVideos": 500,
  "videos": [
    {
      "id": "video_id_1",
      "title": "Tom Clancy's The Division 2 2025 03 29   10 01 17 02 going rogue gone wrong",
      "description": "Tom Clancy's The Division 2 2025 03 29   10 01 17 02",
      "publishedAt": "2025-03-29T10:01:17Z",
      "recordingDate": "2025-03-29T10:01:17Z",
      "lastUpdated": "2025-06-27T15:50:45Z"
    }
  ]
}
```

#### Error Handling
- **Network Errors**: Retry with exponential backoff
- **Rate Limits**: Stop immediately, log current page
- **Malformed Data**: Skip video, log warning
- **File I/O Errors**: Backup existing data before writing

#### Resume Capability
- **Temporary File**: `data/video-database-temp.json`
- **Progress File**: `data/video-database-progress.json`
- **Resume Logic**: Check for existing files on startup
- **Cleanup**: Remove temporary files on completion

## Acceptance Criteria
- [ ] Successfully fetches all videos from channel
- [ ] Handles pagination correctly (no duplicates, no missing videos)
- [ ] Extracts datetime information accurately
- [ ] Provides clear progress logging
- [ ] Can resume from any page if interrupted
- [ ] Respects rate limits and handles errors gracefully
- [ ] Output file is valid JSON and contains all videos

## Edge Cases
- Handle channels with thousands of videos
- Deal with videos with missing metadata
- Handle API rate limit exhaustion
- Manage network timeouts
- Handle malformed video data
- Deal with videos in different languages

## Dependencies
- PRD 1.2 (YouTube API Integration)
- PRD 1.3 (Configuration System)

## Estimated Time
3 hours

## Notes
This is a critical foundation task. The quality of this database affects all subsequent processing. Focus on reliability and completeness.
